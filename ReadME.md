-- BOOK45 테이블 생성
CREATE TABLE BOOK(
NUM NUMBER(5), 
ISBN NUMBER(38) PRIMARY KEY,
CATEGORY NVARCHAR2(1000),
TITLE NVARCHAR2(1000), 
PRICE NUMBER(10), 
SUMMARY VARCHAR2(4000),
AUTHOR NVARCHAR2(1000), 
PUB NVARCHAR2(1000),
RATINGAVG NUMBER(3, 1) DEFAULT 0,
PICTUREURL VARCHAR2(4000),
STOCK NUMBER(10) DEFAULT 10
);

CREATE TABLE BOOKREVIEW(
NUM NUMBER(10) PRIMARY KEY NOT NULL,
ISBN NUMBER(38) CONSTRAINT FK_ISBN REFERENCES BOOK(ISBN) ON DELETE CASCADE,
ID VARCHAR2(20) CONSTRAINT FK_BOOKREVIEWID REFERENCES MEMBER(ID) ON DELETE CASCADE NOT NULL,
NICKNAME VARCHAR2(30) NULL,
CONTENT VARCHAR2(4000) NULL,
RATING NUMBER(3, 1) NOT NULL,
WRITEDATE DATE DEFAULT SYSDATE
);

CREATE TABLE ALBUM(
NUM NUMBER(5),
PRODUCTNUM NUMBER(38) PRIMARY KEY,
CATEGORY VARCHAR2(3000),
ALBUMTITLE VARCHAR2(3000),
ALBUMPRICE NUMBER(10),
SINGER VARCHAR2(3000),
ENT VARCHAR2(3000),
RELEASEDATE VARCHAR2(3000),
RATINGAVG NUMBER(3, 1) DEFAULT 0,
ALBUMPICTUREURL VARCHAR2(4000),
STOCK NUMBER(5) DEFAULT 10
);

CREATE TABLE ALBUMREVIEW(
NUM NUMBER(10) PRIMARY KEY,
PRODUCTNUM NUMBER(38) CONSTRAINT FK_PRODUCTNUM REFERENCES ALBUM(PRODUCTNUM) ON DELETE CASCADE NOT NULL,
ID VARCHAR2(20) CONSTRAINT FK_ALBUMREVIEWID REFERENCES MEMBER(ID) ON DELETE CASCADE NOT NULL,
NICKNAME VARCHAR2(30) NOT NULL,
CONTENT VARCHAR2(4000),
RATING NUMBER(3, 1) NOT NULL,
WRITEDATE DATE DEFAULT SYSDATE
);

CREATE TABLE MEMBER(
ID VARCHAR2(20) PRIMARY KEY,
PASS VARCHAR2(2000) NOT NULL,
NAME VARCHAR2(20),
NICKNAME VARCHAR2(200),
PHONE VARCHAR2(20),
EMAIL VARCHAR2(50),
ZIPCODE VARCHAR2(10),
ADDRESSROAD VARCHAR2(1000),
ADDRESSDETAIL VARCHAR2(2000),
LEV CHAR(1) DEFAULT 'B', -- A: 관리자, B: 일반회원
POINT NUMBER(10)
);

CREATE TABLE KAKAO(
KAKAONUM NUMBER(38) PRIMARY KEY,
NICKNAME VARCHAR2(100) NOT NULL,
EMAIL VARCHAR2(100) NOT NULL
);

CREATE TABLE CART(
CARTNUM NUMBER(10) PRIMARY KEY,
ID VARCHAR2(20) CONSTRAINT CART_ID_FK REFERENCES MEMBER(ID) ON DELETE CASCADE,
ISBN NUMBER(38) CONSTRAINT CART_ISBN_FK REFERENCES BOOK(ISBN) ON DELETE CASCADE,
PRODUCTNUM NUMBER(38) CONSTRAINT CART_PRODUCTNUM_FK REFERENCES ALBUM(PRODUCTNUM) ON DELETE CASCADE,
AMOUNT NUMBER(5)
);

CREATE TABLE ORDERS(
ORDERNUM VARCHAR2(500) PRIMARY KEY,
ID VARCHAR2(20) CONSTRAINT ORDERS_ID_FK REFERENCES MEMBER(ID) ON DELETE CASCADE,
NAME VARCHAR2(20),
PHONE VARCHAR2(20),
ORDERDATE DATE DEFAULT SYSDATE,
ZIPCODE VARCHAR2(10),
ADDRESSROAD VARCHAR2(1000),
ADDRESSDETAIL VARCHAR2(2000),
ORDERSTATE VARCHAR2(30),
DELIVERYCOST NUMBER(10),
USEPOINT NUMBER(10)
);

CREATE TABLE ORDERITEM(
ORDERITEMNUM NUMBER(10) PRIMARY KEY,
ORDERNUM VARCHAR2(500) CONSTRAINT ORDERITEM_ORDERNUM_FK REFERENCES ORDERS(ORDERNUM) ON DELETE CASCADE,
ID VARCHAR2(20) CONSTRAINT ORDERITEM_ID_FK REFERENCES MEMBER(ID) ON DELETE CASCADE,
ISBN NUMBER(38) NULL CONSTRAINT ORDERITEM_ISBN_FK REFERENCES BOOK(ISBN) ON DELETE CASCADE,
PRODUCTNUM NUMBER(38) NULL CONSTRAINT ORDERITEM_PRODUCTNUM_FK REFERENCES ALBUM(PRODUCTNUM) ON DELETE CASCADE,
PRICE NUMBER(10),
ALBUMPRICE NUMBER(10),
AMOUNT NUMBER(5)
);

CREATE TABLE BOARD(
NUM NUMBER(10) PRIMARY KEY,
MEMBERID VARCHAR2(20) CONSTRAINT BOARD_ID_FK REFERENCES MEMBER(ID) ON DELETE CASCADE,
PASS VARCHAR2(20) NOT NULL,
TITLE VARCHAR2(1000) NOT NULL,
CONTENT VARCHAR2(4000) NOT NULL,
WRITEDATE DATE DEFAULT SYSDATE,
UPDATEDATE DATE DEFAULT SYSDATE,
READCOUNT NUMBER(30) DEFAULT 0,
REPLYCNT NUMBER(10) DEFAULT 0,
BLIND CHAR(10) DEFAULT 0
);

CREATE TABLE REPLY(
REPLYNUM NUMBER(10) PRIMARY KEY,
BOARDNUM NUMBER(10) CONSTRAINT REPLY_NUM_FK REFERENCES BOARD(NUM) ON DELETE CASCADE,
MEMBERID VARCHAR2(20) CONSTRAINT REPLY_ID_FK REFERENCES MEMBER(ID) ON DELETE CASCADE,
NICKNAME VARCHAR2(30) NOT NULL,
CONTENT VARCHAR2(4000) NOT NULL,
REPLYDATE DATE DEFAULT SYSDATE,
SECRET CHAR(10) DEFAULT 0 NOT NULL
);

CREATE TABLE NOTICE(
NUM NUMBER(10) PRIMARY KEY,
ID VARCHAR2(20) CONSTRAINT NOTICE_ID_FK REFERENCES MEMBER(ID) ON DELETE CASCADE,
TITLE VARCHAR2(1000) NOT NULL,
CONTENT VARCHAR2(4000) NOT NULL,
WRITEDATE DATE DEFAULT SYSDATE,
UPDATEDATE DATE DEFAULT SYSDATE,
READCOUNT NUMBER(10) DEFAULT 0
);

CREATE TABLE QNA(
QNUM NUMBER(10) PRIMARY KEY,
ID VARCHAR2(20) CONSTRAINT QNA_ID_FK REFERENCES MEMBER(ID) ON DELETE CASCADE,
TITLE VARCHAR2(1000) NOT NULL,
CONTENT VARCHAR2(4000) NOT NULL,
WRITEDATE DATE DEFAULT SYSDATE,
UPDATEDATE DATE DEFAULT SYSDATE,
SECRET VARCHAR2(20),
REPLYCNT NUMBER(10) DEFAULT 0
);

CREATE TABLE QNAREPLY(
RENUM NUMBER(10) PRIMARY KEY,
QNUM NUMBER(10) CONSTRAINT QNAREPLY_QNUM_FK REFERENCES QNA(QNUM) ON DELETE CASCADE,
ID VARCHAR2(20) CONSTRAINT QNAREPLY_ID_FK REFERENCES MEMBER(ID) ON DELETE CASCADE,
CONTENT VARCHAR2(4000) NOT NULL,
WRITEDATE DATE DEFAULT SYSDATE
);

-- BOOK45 시퀀스 생성
CREATE SEQUENCE BOOK45_SEQ;

CREATE SEQUENCE BOOKREVIEW_SEQ;

CREATE SEQUENCE ALBUM_SEQ;

CREATE SEQUENCE ALBUMREVIEW_SEQ;

CREATE SEQUENCE KAKAO_SEQ;

CREATE SEQUENCE CART_SEQ;

CREATE SEQUENCE ORDERITEM_SEQ;

CREATE SEQUENCE BOARD_SEQ;

CREATE SEQUENCE REPLY_SEQ;

CREATE SEQUENCE NOTICE_SEQ;

CREATE SEQUENCE QNA_SEQ;

CREATE SEQUENCE QNAREPLY_SEQ;

-- 인덱스 생성
CREATE INDEX IDX_BOOK ON BOOK(NUM ASC, ISBN ASC);

CREATE INDEX IDX_BOOKREVIEW ON BOOKREVIEW(NUM ASC, ISBN ASC);

CREATE INDEX IDX_ALBUM ON ALBUM(NUM ASC, PRODUCTNUM ASC);

CREATE INDEX IDX_ALBUMREVIEW ON ALBUMREVIEW(NUM ASC, PRODUCTNUM ASC);

CREATE INDEX IDX_BOARD ON BOARD(NUM DESC);

CREATE INDEX IDX_REPLY ON REPLY(BOARDNUM DESC, REPLYNUM ASC);

CREATE INDEX IDX_NOTICE ON NOTICE(NUM DESC);

CREATE INDEX IDX_QNA ON QNA(QNUM DESC);

-- BOOK45 전체 데이터 조회
SELECT * FROM BOOK;

SELECT DISTINCT CATEGORY FROM BOOK ORDER BY CATEGORY;

SELECT * FROM BOOKREVIEW ORDER BY NUM;

SELECT * FROM BOOKIMAGE;

SELECT * FROM ALBUM;

SELECT DISTINCT(CATEGORY) FROM ALBUM ORDER BY CATEGORY;

SELECT * FROM ALBUMREVIEW ORDER BY NUM;

SELECT * FROM MEMBER ORDER BY LEV, ID;

SELECT * FROM KAKAO;

SELECT * FROM CART ORDER BY CARTNUM;

SELECT * FROM ORDERS WHERE ID = 'pinksung' ORDER BY ORDERNUM; 

SELECT * FROM ORDERITEM ORDER BY ORDERITEMNUM;

SELECT * FROM BOARD ORDER BY NUM DESC;

SELECT * FROM REPLY ORDER BY REPLYNUM ASC;

SELECT * FROM NOTICE ORDER BY NUM DESC;

SELECT * FROM QNA;

SELECT * FROM QNAREPLY;

-- BOOK45 칼럼 자료형 조회
DESC BOOK;

DESC BOOKREVIEW;

DESC BOOKIMAGE;

DESC ALBUM;

DESC ALBUMREVIEW;

DESC MEMBER;

DESC KAKAO;

DESC CART;

DESC ORDERS;

DESC ORDERITEM;

DESC BOARD;

DESC REPLY;

DESC NOTICE;

DESC QNA;

DESC QNAREPLY;

-- BOOK45 테이블 삭제
DROP TABLE BOOK CASCADE CONSTRAINTS;

DROP TABLE BOOKREVIEW;

DROP TABLE BOOKIMAGE;

DROP TABLE ALBUM CASCADE CONSTRAINTS;

DROP TABLE ALBUMREVIEW;

DROP TABLE MEMBER;

DROP TABLE KAKAO;

DROP TABLE CART;

DROP TABLE ORDERS CASCADE CONSTRAINTS;

DROP TABLE ORDERITEM;

DROP TABLE BOARD CASCADE CONSTRAINTS;

DROP TABLE REPLY CASCADE CONSTRAINTS;

DROP TABLE NOTICE;

DROP TABLE QNA CASCADE CONSTRAINTS;

DROP TABLE QNAREPLY;

-- BOOK45 시퀀스 삭제
DROP SEQUENCE BOOK_SEQ;

DROP SEQUENCE BOOKREVIEW_SEQ;

DROP SEQUENCE ALBUM_SEQ;

DROP SEQUENCE ALBUMREVIEW_SEQ;

DROP SEQUENCE KAKAO_SEQ;

DROP SEQUENCE CART_SEQ;

DROP SEQUENCE ORDERITEM_SEQ;

DROP SEQUENCE BOARD_SEQ;

DROP SEQUENCE REPLY_SEQ;

DROP SEQUENCE NOTICE_SEQ;

DROP SEQUENCE QNA_SEQ;

DROP SEQUENCE QNAREPLY_SEQ;

-- 인덱스 삭제
DROP INDEX IDX_BOOK;

DROP INDEX IDX_BOOKREVIEW;

DROP INDEX IDX_ALBUM;

DROP INDEX IDX_ALBUMREVIEW;

DROP INDEX IDX_BOARD;

DROP INDEX IDX_REPLY;

DROP INDEX IDX_NOTICE;

DROP INDEX IDX_QNA;

-- 회원가입 후 관리자 권한 설정 UPDATE MEMBER SET LEV = 'A' WHERE ID = '';
